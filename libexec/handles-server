#!/bin/bash
# Usage: handles server
# Summary: Start the project locally

set -e

cd "$(git rev-parse --show-toplevel 2>/dev/null)"

handles-update

if [ -f "docker-compose.yml" ]; then
  if ! command -v docker-compose &>/dev/null; then
    echo "!!! Error: docker-compose is not installed" >&2
    exit 1
  fi

  exec docker-compose up
fi

if [ -f "Procfile" ] || [ -f "Procfile.local" ]; then
  if ! command -v forego &>/dev/null; then
    echo "!!! Error: forego is not installed" >&2
    exit 1
  fi

  test -f "Procfile.local" && PROCFILE="Procfile.local" || PROCFILE="Procfile"
  exec forego start -f "$PROCFILE"
fi

if [ -f "manage.py" ]; then
  exec pipenv run python manage.py runserver
fi

if [ -f "package.json" ]; then
  exec yarn run start
fi
